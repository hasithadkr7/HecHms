"""
@file
@brief Helpers for CI.
"""


def is_travis_or_appveyor(env=None):
    """
    Tells if is a travis environment or appveyor.

    @param      env         checks that a environment variable is set up.
    @return                 ``'travis'``, ``'appveyor'`` or ``None``

    The function should rely more on environement variables
    ``CI``, ``TRAVIS``, ``APPVEYOR``.

    .. versionchanged:: 1.5
        Takes into account *circleci*.

    .. versionadded:: 1.8
        Parameter *env* was added.
    """
    import sys
    if "travis" in sys.executable:
        return "travis"
    import os
    if os.environ.get("USERNAME", os.environ.get("USER", None)) == "appveyor" or \
       os.environ.get("APPVEYOR", "").lower() in ("true", "1"):
        return "appveyor"
    if os.environ.get('CIRCLECI', "undefined") != "undefined":
        return "circleci"
    if env is not None:
        for k in env:
            if k in os.environ and os.environ[k]:
                return k
    return None
